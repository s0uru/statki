(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,21602,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(151);e.i(36180);var l=e.i(98925),r=e.i(71935),i=e.i(18566);let o=[{size:4,name:"Czteromasztowiec"},{size:3,name:"Trzymasztowiec"},{size:2,name:"Dwumasztowiec"},{size:2,name:"Dwumasztowiec"},{size:1,name:"Jednomasztowiec"},{size:1,name:"Jednomasztowiec"},{size:1,name:"Jednomasztowiec"}];function n(){let{user:e,loading:n}=(0,r.useAuth)(),d=(0,i.useRouter)();(0,s.useEffect)(()=>{n||e||d.push("/user/signin")},[e,n,d]);let[c,h]=(0,s.useState)([]),[u,x]=(0,s.useState)([]),[m,p]=(0,s.useState)("setup"),[g,f]=(0,s.useState)("player"),[b,w]=(0,s.useState)(["Witaj w Bitwie Morskiej!"]),[y,j]=(0,s.useState)([]),[N,v]=(0,s.useState)({shots:0,hits:0}),k=(e,t,s,a,l)=>{if(l){if(s+a>10)return!1}else if(t+a>10)return!1;let r=Math.max(0,t-1),i=Math.min(9,t+(l?1:a)),o=Math.max(0,s-1),n=Math.min(9,s+(l?a:1));for(let t=r;t<=i;t++)for(let s=o;s<=n;s++)if(e[10*t+s].hasShip)return!1;return!0},z=(e,t,s,a,l,r)=>{for(let i=0;i<a;i++){let a=l?10*t+s+i:(t+i)*10+s;e[a]={...e[a],hasShip:!0,shipId:r}}},S=()=>{let e=Array(100).fill(null).map(()=>({status:"empty",hasShip:!1,shipId:null}));for(let t=0;t<o.length;t++){let s=o[t],a=!1,l=0,r=`${s.name}-${t}`;for(;!a&&l<200;){l++;let t=.5>Math.random(),i=Math.floor(100*Math.random()),o=Math.floor(i/10),n=i%10;k(e,o,n,s.size,t)&&(z(e,o,n,s.size,t,r),a=!0)}if(!a)return S()}return e},T=e=>w(t=>[e,...t].slice(0,5)),M=(e,t)=>{let s=e.map((e,s)=>e.shipId===t?s:null).filter(e=>null!==e);return!!s.every(t=>"hit"===e[t].status||"sunk"===e[t].status)&&(s.forEach(t=>e[t].status="sunk"),!0)};(0,s.useEffect)(()=>{if("enemy"===g&&"playing"===m){let e=setTimeout(()=>I(),1e3);return()=>clearTimeout(e)}},[g,m,c]);let I=()=>{let e,t=[...c];if(y.length>0){let s=[];if(y.forEach(e=>{let a,l,r,i=(r=[],[[(a=Math.floor(e/10))-1,l=e%10],[a+1,l],[a,l-1],[a,l+1]].forEach(([e,t])=>{e>=0&&e<10&&t>=0&&t<10&&r.push(10*e+t)}),r);s.push(...i.filter(e=>"empty"===t[e].status))}),s.length>0){let t=[...new Set(s)];e=t[Math.floor(Math.random()*t.length)]}}if(void 0===e){let s=t.map((e,t)=>"empty"===e.status?t:null).filter(e=>null!==e);if(0===s.length)return;e=s[Math.floor(Math.random()*s.length)]}let s=t[e];if(s.hasShip){s.status="hit";let a=[...y,e];M(t,s.shipId)?(T("Wróg zatopił Twój statek! Ma kolejny ruch."),j(a.filter(e=>t[e].shipId!==s.shipId))):(T("Wróg trafił Twój statek! Ma kolejny ruch."),j(a)),h(t),A(t,"enemy")}else s.status="miss",T("Wróg spudłował."),h(t),f("player")},A=(e,t)=>!e.some(e=>e.hasShip&&"hit"!==e.status&&"sunk"!==e.status)&&(p("player"===t?"won":"lost"),T("player"===t?"ZWYCIĘSTWO!":"PORAŻKA!"),"player"===t?C(!0):C(!1),!0),C=async t=>{if(e)try{let s={...N};t&&(s.shots+=1,s.hits+=1),await (0,l.addDoc)((0,l.collection)(a.db,"games"),{user:e.uid,userEmail:e.email,result:t?"win":"loss",date:(0,l.serverTimestamp)(),hits:s.hits,shots:s.shots,type:"singleplayer"})}catch(e){console.error(e)}},R=(e,s,a)=>{let l="bg-blue-50",r=null;return!a&&e.hasShip&&"empty"===e.status&&(l="bg-gray-400"),"miss"===e.status&&(l="bg-blue-200",r=(0,t.jsx)("span",{className:"text-blue-500 font-bold",children:"•"})),"hit"===e.status&&(l="bg-orange-400",r=(0,t.jsx)("span",{className:"text-white font-bold",children:"X"})),"sunk"===e.status&&(l="bg-red-700 border-red-800",r=(0,t.jsx)("span",{className:"text-black font-extrabold",children:"☠"})),(0,t.jsx)("div",{onClick:()=>a?(e=>{if("playing"!==m||"player"!==g||"empty"!==u[e].status&&"ship"!==u[e].status)return;v(e=>({...e,shots:e.shots+1}));let t=[...u],s=t[e];s.hasShip?(v(e=>({...e,hits:e.hits+1})),s.status="hit",T(M(t,s.shipId)?"TRAFIENIE I ZATOPIENIE! Masz dodatkowy ruch.":"Trafienie! Masz dodatkowy ruch."),x(t),A(t,"player")):(s.status="miss",T("Pudło."),x(t),f("enemy"))})(s):null,className:`w-full aspect-square border border-blue-200 flex items-center justify-center text-sm transition-colors duration-300 ${l} ${a?"cursor-pointer hover:bg-blue-200":"cursor-default"}`,children:r},s)};return n?(0,t.jsx)("div",{className:"text-center p-10",children:"Ładowanie..."}):(0,t.jsxs)("div",{className:"max-w-6xl mx-auto p-4 space-y-8",children:[(0,t.jsx)("h1",{className:"text-4xl font-black text-center text-indigo-900 uppercase tracking-widest drop-shadow-sm",children:"Strefa Bojowa"}),"setup"===m&&(0,t.jsxs)("div",{className:"text-center bg-white p-10 rounded-2xl shadow-xl max-w-2xl mx-auto border border-gray-100",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Gotowy do walki?"}),(0,t.jsxs)("p",{className:"mb-8 text-gray-600 text-lg",children:["Celność jest teraz liczona! Strzelaj rozważnie.",(0,t.jsx)("br",{}),"Statki nie mogą się stykać."]}),(0,t.jsx)("button",{onClick:()=>{h(S()),x(S()),p("playing"),f("player"),j([]),v({shots:0,hits:0}),w(["Bitwa rozpoczęta! Twój ruch."])},className:"bg-indigo-600 text-white px-10 py-4 rounded-full font-bold text-lg shadow-lg hover:bg-indigo-700 transition transform hover:scale-105 active:scale-95",children:"ROZPOCZNIJ BITWĘ"})]}),"setup"!==m&&(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 justify-center items-start",children:[(0,t.jsxs)("div",{className:"flex-1 w-full max-w-md",children:[(0,t.jsx)("h2",{className:"text-center font-bold mb-3 text-gray-700 text-lg tracking-wide",children:"TY"}),(0,t.jsx)("div",{className:`grid grid-cols-10 gap-px border-4 border-gray-300 bg-gray-300 shadow-2xl rounded-lg overflow-hidden ${"enemy"===g?"opacity-80 grayscale-[0.3]":""}`,children:c.map((e,t)=>R(e,t,!1))})]}),(0,t.jsxs)("div",{className:"w-full lg:w-72 bg-gray-800 p-4 rounded-2xl shadow-2xl border-2 border-gray-700 flex flex-col mt-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-600 pb-3 mb-3",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-gray-400 text-[10px] uppercase font-bold tracking-widest",children:"Status"}),(0,t.jsx)("span",{className:`font-black text-lg ${"playing"===m?"player"===g?"text-green-400 animate-pulse":"text-red-400":"text-white"}`,children:"playing"===m?"player"===g?"TWOJA TURA":"RUCH WROGA":"won"===m?"ZWYCIĘSTWO!":"PORAŻKA"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[(0,t.jsx)("span",{className:"text-gray-400 text-[10px] uppercase font-bold tracking-widest",children:"Celność"}),(0,t.jsxs)("span",{className:"text-yellow-400 font-mono text-lg font-bold",children:[N.shots>0?Math.round(N.hits/N.shots*100):0,"%"]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto space-y-2 font-mono text-xs text-gray-300 pr-2 custom-scrollbar h-64",children:b.map((e,s)=>(0,t.jsx)("div",{className:`p-2 rounded border-l-4 ${0===s?"bg-gray-700 border-green-500 text-white shadow-md":"border-gray-600 text-gray-400"}`,children:(0,t.jsx)("p",{className:"break-words leading-relaxed",children:e})},s))}),("won"===m||"lost"===m)&&(0,t.jsx)("button",{onClick:()=>p("setup"),className:"mt-4 w-full bg-indigo-600 text-white py-2 rounded-lg font-bold hover:bg-indigo-500 transition shadow-lg uppercase tracking-wide text-sm",children:"Zagraj Ponownie"})]}),(0,t.jsxs)("div",{className:"flex-1 w-full max-w-md",children:[(0,t.jsx)("h2",{className:"text-center font-bold mb-3 text-red-600 text-lg tracking-wide",children:"WRÓG"}),(0,t.jsxs)("div",{className:`grid grid-cols-10 gap-px border-4 border-red-300 bg-red-300 shadow-2xl rounded-lg overflow-hidden relative transition-all duration-300 ${"player"!==g?"opacity-90 cursor-not-allowed":"hover:scale-[1.01]"}`,children:[u.map((e,t)=>R(e,t,!0)),"player"!==g&&"playing"===m&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[2px]",children:(0,t.jsx)("div",{className:"bg-black/80 text-white px-4 py-2 rounded-full shadow-2xl text-xs font-bold animate-pulse tracking-widest border border-red-500/50",children:"ANALIZA RUCHU..."})})]})]})]})]})}e.s(["default",()=>n])}]);